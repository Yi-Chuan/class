<!doctype html>
<html>
<head>
	<meta charset=UTF-8"utf-8">
	<title>Laravel 5.1 ä¸­æ–‡æ–‡æ¡£ï¼šé˜Ÿåˆ—
</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="author" content="@summerblue">
	<meta name="description" content="é˜Ÿåˆ—,ç®€ä»‹,ç¼–å†™ä»»åŠ¡ç±»,ç”Ÿæˆä»»åŠ¡ç±»,ä»»åŠ¡ç±»ç»“æ„,å°†ä»»åŠ¡æ¨é€åˆ°é˜Ÿåˆ—ä¸Š,å»¶è¿Ÿæ€§ä»»åŠ¡,ä»è¯·æ±‚ä¸­æ´¾é€ä»»åŠ¡,ä»»åŠ¡äº‹ä»¶,è¿è¡Œé˜Ÿåˆ—ä¾¦å¬å™¨,Supervisor è®¾ç½®,å°†ä»»åŠ¡ä¾¦å¬å™¨è®¾ä¸ºåå°æœåŠ¡,éšç€åœ¨åå°æœåŠ¡çš„ä»»åŠ¡ä¾¦å¬å™¨è¿›è¡Œå¸ƒç½²,å¤„ç†å¤±è´¥çš„ä»»åŠ¡,ä»»åŠ¡å¤±è´¥äº‹ä»¶,é‡æ–°å°è¯•è¿è¡Œå¤±è´¥ä»»åŠ¡,ç®€ä»‹,Laravel çš„é˜Ÿåˆ—æœåŠ¡ä¸ºä¸åŒçš„é˜Ÿåˆ—åç«¯ç³»ç»Ÿæä¾›äº†ä¸€å¥—ç»Ÿä¸€çš„ API ã€‚é˜Ÿåˆ—å…è®¸ä½ å°†ä¸€ä¸ªè€—æ—¶çš„ä»»åŠ¡è¿›è¡Œå»¶è¿Ÿå¤„ç†ï¼Œä¾‹å¦‚åƒ e-m...
">
	<meta name="keywords" content="é˜Ÿåˆ—,laravel5.1æ–‡æ¡£,laravel5.1ä¸­æ–‡æ–‡æ¡£,laravelä¸­å›½,laravelä¸­æ–‡,laravelæ¡†æ¶ä¸­æ–‡,laravelæ–‡æ¡£,laravelæ¡†æ¶ä¸­å›½,laravelä¸­æ–‡æ–‡æ¡£
">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--[if lte IE 9]>
		<script src="html5shiv.min.js" tppabs="http://libs.useso.com/js/html5shiv/3.7/html5shiv.min.js"></script>
	<![endif]-->
	<link rel="stylesheet" href="laravel.css" tppabs="http://laravel-china.org/assets/css/laravel.css">
	<style media="screen">
		div.main-content {
		  display: none;
		}
		.loading-effect {
			position: fixed;
			left: 50%;
			top:300px;
		    z-index: -1;
		}
	</style>
</head>
<body class="docs language-php ">

	<span class="overlay"></span>

	<div class="loading-effect">
		<div class="loader-inner line-scale">
		      <div></div>
		      <div></div>
		      <div></div>
		      <div></div>
		      <div></div>
		  </div>
	</div>


	<div class="main-content">

		<nav class="main">
			<div class="container">
				<a href="javascript:if(confirm('http://laravel-china.org/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://laravel-china.org/'" tppabs="http://laravel-china.org/" class="brand">
					<img src="laravel-logo.png" tppabs="http://laravel-china.org/assets/img/laravel-logo.png" height="30">
					Laravel
				</a>

				<div class="responsive-sidebar-nav">
					<a href="#" class="toggle-slide menu-link btn">&#9776;</a>
				</div>

									<div class="switcher">
	<div class="dropdown">
		<button class="btn dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
			<!--<span class="faint">v</span> -->
			5.1
			<span class="caret"></span>
		</button>
		<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
							<li role="presentation">
					<a role="menuitem" tabindex="-1" href="queues.htm" tppabs="http://laravel-china.org/docs/5.1/queues">5.1</a>
				</li>
							<li role="presentation">
					<a role="menuitem" tabindex="-1" href="queues-1.htm" tppabs="http://laravel-china.org/docs/4.2/queues">4.2</a>
				</li>
					</ul>
	</div>
</div>
				
				<ul class="main-nav">
					<li class="nav-docs"><a href="javascript:if(confirm('http://laravel-china.org/docs  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://laravel-china.org/docs'" tppabs="http://laravel-china.org/docs">æ–‡æ¡£</a></li>
<li class="nav-laracasts"><a href="javascript:if(confirm('https://laracasts.com/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ÊÇÒ»¸öÊ¹ÓÃÎ´Ö§³ÖĞ­ÒéµÄµØÖ·(ÀıÈç: gopher)¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='https://laracasts.com/'" tppabs="https://laracasts.com/" target="_blank">Laracasts</a></li>
<li class="nav-docs"><a href="javascript:if(confirm('http://lumen.laravel-china.org/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://lumen.laravel-china.org/'" tppabs="http://lumen.laravel-china.org/">Lumen</a></li>
<li class="nav-forge"><a href="javascript:if(confirm('https://cs.phphub.org/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ÊÇÒ»¸öÊ¹ÓÃÎ´Ö§³ÖĞ­ÒéµÄµØÖ·(ÀıÈç: gopher)¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='https://cs.phphub.org/'" tppabs="https://cs.phphub.org/" target="_blank">Laravel LTS é€ŸæŸ¥è¡¨</a></li>
<li class="dropdown">
	<a href="javascript:if(confirm('https://phphub.org/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ÊÇÒ»¸öÊ¹ÓÃÎ´Ö§³ÖĞ­ÒéµÄµØÖ·(ÀıÈç: gopher)¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='https://phphub.org/'" tppabs="https://phphub.org/" target="_blank">Laravel ç¤¾åŒº</a>
</li>
				</ul>
			</div>
		</nav>

		<nav id="slide-menu" class="slide-menu" role="navigation">

	<div class="brand">
		<a href="javascript:if(confirm('http://laravel-china.org/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://laravel-china.org/'" tppabs="http://laravel-china.org/">
			<img src="laravel-logo-white.png" tppabs="http://laravel-china.org/assets/img/laravel-logo-white.png" height="50">
		</a>
	</div>

	<ul class="slide-main-nav">
		<li><a href="javascript:if(confirm('http://laravel-china.org/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://laravel-china.org/'" tppabs="http://laravel-china.org/">Home</a></li>
		<li class="nav-docs"><a href="javascript:if(confirm('http://laravel-china.org/docs  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://laravel-china.org/docs'" tppabs="http://laravel-china.org/docs">æ–‡æ¡£</a></li>
<li class="nav-laracasts"><a href="javascript:if(confirm('https://laracasts.com/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ÊÇÒ»¸öÊ¹ÓÃÎ´Ö§³ÖĞ­ÒéµÄµØÖ·(ÀıÈç: gopher)¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='https://laracasts.com/'" tppabs="https://laracasts.com/" target="_blank">Laracasts</a></li>
<li class="nav-docs"><a href="javascript:if(confirm('http://lumen.laravel-china.org/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://lumen.laravel-china.org/'" tppabs="http://lumen.laravel-china.org/">Lumen</a></li>
<li class="nav-forge"><a href="javascript:if(confirm('https://cs.phphub.org/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ÊÇÒ»¸öÊ¹ÓÃÎ´Ö§³ÖĞ­ÒéµÄµØÖ·(ÀıÈç: gopher)¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='https://cs.phphub.org/'" tppabs="https://cs.phphub.org/" target="_blank">Laravel LTS é€ŸæŸ¥è¡¨</a></li>
<li class="dropdown">
	<a href="javascript:if(confirm('https://phphub.org/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ÊÇÒ»¸öÊ¹ÓÃÎ´Ö§³ÖĞ­ÒéµÄµØÖ·(ÀıÈç: gopher)¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='https://phphub.org/'" tppabs="https://phphub.org/" target="_blank">Laravel ç¤¾åŒº</a>
</li>
	</ul>

	<div class="slide-docs-nav">
		<h2>æ–‡æ¡£</h2>

		<a type="button" class="turnofflight"><i class="fa fa-lightbulb-o"></i> <i class="fa fa-star-o"></i> å¤œé—´æ¨¡å¼ </a>
		<ul>
<li>å‰è¨€
<ul>
<li><a href="about.htm" tppabs="http://laravel-china.org/docs/5.1/about">ç¿»è¯‘è¯´æ˜</a></li>
<li><a href="releases.htm" tppabs="http://laravel-china.org/docs/5.1/releases">å‘è¡Œè¯´æ˜</a></li>
<li><a href="upgrade.htm" tppabs="http://laravel-china.org/docs/5.1/upgrade">å‡çº§å¯¼å¼•</a></li>
<li><a href="contributions.htm" tppabs="http://laravel-china.org/docs/5.1/contributions">è´¡çŒ®å¯¼å¼•</a></li>
<li><a href="javascript:if(confirm('http://laravel-china.org/api/5.1  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://laravel-china.org/api/5.1'" tppabs="http://laravel-china.org/api/5.1">API æ–‡æ¡£</a></li>
</ul></li>
<li>ç¯å¢ƒé…ç½®
<ul>
<li><a href="installation.htm" tppabs="http://laravel-china.org/docs/5.1/installation">å®‰è£…</a></li>
<li><a href="homestead.htm" tppabs="http://laravel-china.org/docs/5.1/homestead">Homestead</a></li>
</ul></li>
<li>åŸºæœ¬åŠŸèƒ½
<ul>
<li><a href="routing.htm" tppabs="http://laravel-china.org/docs/5.1/routing">è·¯ç”±</a></li>
<li><a href="middleware.htm" tppabs="http://laravel-china.org/docs/5.1/middleware">ä¸­é—´ä»¶</a></li>
<li><a href="controllers.htm" tppabs="http://laravel-china.org/docs/5.1/controllers">æ§åˆ¶å™¨</a></li>
<li><a href="requests.htm" tppabs="http://laravel-china.org/docs/5.1/requests">è¯·æ±‚</a></li>
<li><a href="responses.htm" tppabs="http://laravel-china.org/docs/5.1/responses">å“åº”</a></li>
<li><a href="views.htm" tppabs="http://laravel-china.org/docs/5.1/views">è§†å›¾</a></li>
<li><a href="blade.htm" tppabs="http://laravel-china.org/docs/5.1/blade">Blade æ¨¡æ¿</a></li>
</ul></li>
<li>æ•™ç¨‹
<ul>
<li><a href="quickstart.htm" tppabs="http://laravel-china.org/docs/5.1/quickstart">åˆçº§ä»»åŠ¡æ¸…å•</a></li>
<li><a href="quickstart-intermediate.htm" tppabs="http://laravel-china.org/docs/5.1/quickstart-intermediate">ä¸­çº§ä»»åŠ¡æ¸…å•</a></li>
</ul></li>
<li>ç³»ç»Ÿæ¶æ„
<ul>
<li><a href="lifecycle.htm" tppabs="http://laravel-china.org/docs/5.1/lifecycle">è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸ</a></li>
<li><a href="structure.htm" tppabs="http://laravel-china.org/docs/5.1/structure">åº”ç”¨ç¨‹åºç»“æ„</a></li>
<li><a href="providers.htm" tppabs="http://laravel-china.org/docs/5.1/providers">æœåŠ¡æä¾›è€…</a></li>
<li><a href="container.htm" tppabs="http://laravel-china.org/docs/5.1/container">æœåŠ¡å®¹å™¨</a></li>
<li><a href="contracts.htm" tppabs="http://laravel-china.org/docs/5.1/contracts">Contracts</a></li>
<li><a href="facades.htm" tppabs="http://laravel-china.org/docs/5.1/facades">Facades</a></li>
</ul></li>
<li>ç³»ç»ŸæœåŠ¡
<ul>
<li><a href="authentication.htm" tppabs="http://laravel-china.org/docs/5.1/authentication">ç”¨æˆ·è®¤è¯</a></li>
<li><a href="authorization.htm" tppabs="http://laravel-china.org/docs/5.1/authorization">ç”¨æˆ·æˆæƒ</a></li>
<li><a href="artisan.htm" tppabs="http://laravel-china.org/docs/5.1/artisan">Artisan å‘½ä»¤è¡Œ</a></li>
<li><a href="billing.htm" tppabs="http://laravel-china.org/docs/5.1/billing">äº¤æ˜“</a></li>
<li><a href="cache.htm" tppabs="http://laravel-china.org/docs/5.1/cache">ç¼“å­˜</a></li>
<li><a href="collections.htm" tppabs="http://laravel-china.org/docs/5.1/collections">é›†åˆ</a></li>
<li><a href="elixir.htm" tppabs="http://laravel-china.org/docs/5.1/elixir">Elixir</a></li>
<li><a href="encryption.htm" tppabs="http://laravel-china.org/docs/5.1/encryption">åŠ å¯†ä¸è§£å¯†</a></li>
<li><a href="errors.htm" tppabs="http://laravel-china.org/docs/5.1/errors">é”™è¯¯ä¸æ—¥å¿—</a></li>
<li><a href="events.htm" tppabs="http://laravel-china.org/docs/5.1/events">äº‹ä»¶</a></li>
<li><a href="filesystem.htm" tppabs="http://laravel-china.org/docs/5.1/filesystem">æ–‡ä»¶ç³»ç»Ÿä¸äº‘å­˜å‚¨</a></li>
<li><a href="hashing.htm" tppabs="http://laravel-china.org/docs/5.1/hashing">å“ˆå¸Œ</a></li>
<li><a href="helpers.htm" tppabs="http://laravel-china.org/docs/5.1/helpers">è¾…åŠ©å‡½æ•°</a></li>
<li><a href="localization.htm" tppabs="http://laravel-china.org/docs/5.1/localization">æœ¬åœ°åŒ–</a></li>
<li><a href="mail.htm" tppabs="http://laravel-china.org/docs/5.1/mail">é‚®ä»¶</a></li>
<li><a href="packages.htm" tppabs="http://laravel-china.org/docs/5.1/packages">æ‰©å±•åŒ…å¼€å‘</a></li>
<li><a href="pagination.htm" tppabs="http://laravel-china.org/docs/5.1/pagination">åˆ†é¡µ</a></li>
<li><a href="queues.htm" tppabs="http://laravel-china.org/docs/5.1/queues">é˜Ÿåˆ—</a></li>
<li><a href="redis.htm" tppabs="http://laravel-china.org/docs/5.1/redis">Redis</a></li>
<li><a href="session.htm" tppabs="http://laravel-china.org/docs/5.1/session">Session</a></li>
<li><a href="envoy.htm" tppabs="http://laravel-china.org/docs/5.1/envoy">Envoy</a></li>
<li><a href="scheduling.htm" tppabs="http://laravel-china.org/docs/5.1/scheduling">ä»»åŠ¡è°ƒåº¦</a></li>
<li><a href="testing.htm" tppabs="http://laravel-china.org/docs/5.1/testing">æµ‹è¯•</a></li>
<li><a href="validation.htm" tppabs="http://laravel-china.org/docs/5.1/validation">è¡¨å•éªŒè¯</a></li>
</ul></li>
<li>æ•°æ®åº“
<ul>
<li><a href="database.htm" tppabs="http://laravel-china.org/docs/5.1/database">å…¥é—¨</a></li>
<li><a href="queries.htm" tppabs="http://laravel-china.org/docs/5.1/queries">æŸ¥è¯¢æ„é€ å™¨</a></li>
<li><a href="migrations.htm" tppabs="http://laravel-china.org/docs/5.1/migrations">æ•°æ®åº“è¿ç§»</a></li>
<li><a href="seeding.htm" tppabs="http://laravel-china.org/docs/5.1/seeding">æ•°æ®å¡«å……</a></li>
</ul></li>
<li>Eloquent ORM
<ul>
<li><a href="eloquent.htm" tppabs="http://laravel-china.org/docs/5.1/eloquent">å…¥é—¨</a></li>
<li><a href="eloquent-relationships.htm" tppabs="http://laravel-china.org/docs/5.1/eloquent-relationships">æ¨¡å‹å…³è”</a></li>
<li><a href="eloquent-collections.htm" tppabs="http://laravel-china.org/docs/5.1/eloquent-collections">Eloquent é›†åˆ</a></li>
<li><a href="eloquent-mutators.htm" tppabs="http://laravel-china.org/docs/5.1/eloquent-mutators">Getter/Setter</a></li>
<li><a href="eloquent-serialization.htm" tppabs="http://laravel-china.org/docs/5.1/eloquent-serialization">åºåˆ—åŒ–</a></li>
</ul></li>
</ul>
	</div>

</nav>

<div class="docs-wrapper container">

	<section class="sidebar">

		<div class="header">
			<a type="button" class="btn btn-primary btn-lg btn-block turnofflight"><i class="fa fa-lightbulb-o"></i> <i class="fa fa-star-o"></i> å¤œé—´æ¨¡å¼ </a>
		</div>

		<ul>
<li>å‰è¨€
<ul>
<li><a href="about.htm" tppabs="http://laravel-china.org/docs/5.1/about">ç¿»è¯‘è¯´æ˜</a></li>
<li><a href="releases.htm" tppabs="http://laravel-china.org/docs/5.1/releases">å‘è¡Œè¯´æ˜</a></li>
<li><a href="upgrade.htm" tppabs="http://laravel-china.org/docs/5.1/upgrade">å‡çº§å¯¼å¼•</a></li>
<li><a href="contributions.htm" tppabs="http://laravel-china.org/docs/5.1/contributions">è´¡çŒ®å¯¼å¼•</a></li>
<li><a href="javascript:if(confirm('http://laravel-china.org/api/5.1  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://laravel-china.org/api/5.1'" tppabs="http://laravel-china.org/api/5.1">API æ–‡æ¡£</a></li>
</ul></li>
<li>ç¯å¢ƒé…ç½®
<ul>
<li><a href="installation.htm" tppabs="http://laravel-china.org/docs/5.1/installation">å®‰è£…</a></li>
<li><a href="homestead.htm" tppabs="http://laravel-china.org/docs/5.1/homestead">Homestead</a></li>
</ul></li>
<li>åŸºæœ¬åŠŸèƒ½
<ul>
<li><a href="routing.htm" tppabs="http://laravel-china.org/docs/5.1/routing">è·¯ç”±</a></li>
<li><a href="middleware.htm" tppabs="http://laravel-china.org/docs/5.1/middleware">ä¸­é—´ä»¶</a></li>
<li><a href="controllers.htm" tppabs="http://laravel-china.org/docs/5.1/controllers">æ§åˆ¶å™¨</a></li>
<li><a href="requests.htm" tppabs="http://laravel-china.org/docs/5.1/requests">è¯·æ±‚</a></li>
<li><a href="responses.htm" tppabs="http://laravel-china.org/docs/5.1/responses">å“åº”</a></li>
<li><a href="views.htm" tppabs="http://laravel-china.org/docs/5.1/views">è§†å›¾</a></li>
<li><a href="blade.htm" tppabs="http://laravel-china.org/docs/5.1/blade">Blade æ¨¡æ¿</a></li>
</ul></li>
<li>æ•™ç¨‹
<ul>
<li><a href="quickstart.htm" tppabs="http://laravel-china.org/docs/5.1/quickstart">åˆçº§ä»»åŠ¡æ¸…å•</a></li>
<li><a href="quickstart-intermediate.htm" tppabs="http://laravel-china.org/docs/5.1/quickstart-intermediate">ä¸­çº§ä»»åŠ¡æ¸…å•</a></li>
</ul></li>
<li>ç³»ç»Ÿæ¶æ„
<ul>
<li><a href="lifecycle.htm" tppabs="http://laravel-china.org/docs/5.1/lifecycle">è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸ</a></li>
<li><a href="structure.htm" tppabs="http://laravel-china.org/docs/5.1/structure">åº”ç”¨ç¨‹åºç»“æ„</a></li>
<li><a href="providers.htm" tppabs="http://laravel-china.org/docs/5.1/providers">æœåŠ¡æä¾›è€…</a></li>
<li><a href="container.htm" tppabs="http://laravel-china.org/docs/5.1/container">æœåŠ¡å®¹å™¨</a></li>
<li><a href="contracts.htm" tppabs="http://laravel-china.org/docs/5.1/contracts">Contracts</a></li>
<li><a href="facades.htm" tppabs="http://laravel-china.org/docs/5.1/facades">Facades</a></li>
</ul></li>
<li>ç³»ç»ŸæœåŠ¡
<ul>
<li><a href="authentication.htm" tppabs="http://laravel-china.org/docs/5.1/authentication">ç”¨æˆ·è®¤è¯</a></li>
<li><a href="authorization.htm" tppabs="http://laravel-china.org/docs/5.1/authorization">ç”¨æˆ·æˆæƒ</a></li>
<li><a href="artisan.htm" tppabs="http://laravel-china.org/docs/5.1/artisan">Artisan å‘½ä»¤è¡Œ</a></li>
<li><a href="billing.htm" tppabs="http://laravel-china.org/docs/5.1/billing">äº¤æ˜“</a></li>
<li><a href="cache.htm" tppabs="http://laravel-china.org/docs/5.1/cache">ç¼“å­˜</a></li>
<li><a href="collections.htm" tppabs="http://laravel-china.org/docs/5.1/collections">é›†åˆ</a></li>
<li><a href="elixir.htm" tppabs="http://laravel-china.org/docs/5.1/elixir">Elixir</a></li>
<li><a href="encryption.htm" tppabs="http://laravel-china.org/docs/5.1/encryption">åŠ å¯†ä¸è§£å¯†</a></li>
<li><a href="errors.htm" tppabs="http://laravel-china.org/docs/5.1/errors">é”™è¯¯ä¸æ—¥å¿—</a></li>
<li><a href="events.htm" tppabs="http://laravel-china.org/docs/5.1/events">äº‹ä»¶</a></li>
<li><a href="filesystem.htm" tppabs="http://laravel-china.org/docs/5.1/filesystem">æ–‡ä»¶ç³»ç»Ÿä¸äº‘å­˜å‚¨</a></li>
<li><a href="hashing.htm" tppabs="http://laravel-china.org/docs/5.1/hashing">å“ˆå¸Œ</a></li>
<li><a href="helpers.htm" tppabs="http://laravel-china.org/docs/5.1/helpers">è¾…åŠ©å‡½æ•°</a></li>
<li><a href="localization.htm" tppabs="http://laravel-china.org/docs/5.1/localization">æœ¬åœ°åŒ–</a></li>
<li><a href="mail.htm" tppabs="http://laravel-china.org/docs/5.1/mail">é‚®ä»¶</a></li>
<li><a href="packages.htm" tppabs="http://laravel-china.org/docs/5.1/packages">æ‰©å±•åŒ…å¼€å‘</a></li>
<li><a href="pagination.htm" tppabs="http://laravel-china.org/docs/5.1/pagination">åˆ†é¡µ</a></li>
<li><a href="queues.htm" tppabs="http://laravel-china.org/docs/5.1/queues">é˜Ÿåˆ—</a></li>
<li><a href="redis.htm" tppabs="http://laravel-china.org/docs/5.1/redis">Redis</a></li>
<li><a href="session.htm" tppabs="http://laravel-china.org/docs/5.1/session">Session</a></li>
<li><a href="envoy.htm" tppabs="http://laravel-china.org/docs/5.1/envoy">Envoy</a></li>
<li><a href="scheduling.htm" tppabs="http://laravel-china.org/docs/5.1/scheduling">ä»»åŠ¡è°ƒåº¦</a></li>
<li><a href="testing.htm" tppabs="http://laravel-china.org/docs/5.1/testing">æµ‹è¯•</a></li>
<li><a href="validation.htm" tppabs="http://laravel-china.org/docs/5.1/validation">è¡¨å•éªŒè¯</a></li>
</ul></li>
<li>æ•°æ®åº“
<ul>
<li><a href="database.htm" tppabs="http://laravel-china.org/docs/5.1/database">å…¥é—¨</a></li>
<li><a href="queries.htm" tppabs="http://laravel-china.org/docs/5.1/queries">æŸ¥è¯¢æ„é€ å™¨</a></li>
<li><a href="migrations.htm" tppabs="http://laravel-china.org/docs/5.1/migrations">æ•°æ®åº“è¿ç§»</a></li>
<li><a href="seeding.htm" tppabs="http://laravel-china.org/docs/5.1/seeding">æ•°æ®å¡«å……</a></li>
</ul></li>
<li>Eloquent ORM
<ul>
<li><a href="eloquent.htm" tppabs="http://laravel-china.org/docs/5.1/eloquent">å…¥é—¨</a></li>
<li><a href="eloquent-relationships.htm" tppabs="http://laravel-china.org/docs/5.1/eloquent-relationships">æ¨¡å‹å…³è”</a></li>
<li><a href="eloquent-collections.htm" tppabs="http://laravel-china.org/docs/5.1/eloquent-collections">Eloquent é›†åˆ</a></li>
<li><a href="eloquent-mutators.htm" tppabs="http://laravel-china.org/docs/5.1/eloquent-mutators">Getter/Setter</a></li>
<li><a href="eloquent-serialization.htm" tppabs="http://laravel-china.org/docs/5.1/eloquent-serialization">åºåˆ—åŒ–</a></li>
</ul></li>
</ul>
	</section>

	<article>

		<div class="alert alert-warning" role="alert">

			<h4>æ‹¥æŠ± Laravel 5.1 LTS</h4>
			<p>
				å¼ºçƒˆå»ºè®®åœ¨ 2018 å¹´ä¹‹å‰ä½¿ç”¨ Laravel 5.1 æ¥æ„å»ºé¡¹ç›®ï¼ŒLaravel 5.1 æ˜¯ LTS çš„å‘è¡Œç‰ˆæœ¬, å‘è¡Œäº 2015 å¹´ 6 æœˆä»½ï¼Œè‡ªå‘å¸ƒèµ·æä¾›ä¸¤å¹´æ—¶é—´çš„ Bug ä¿®å¤ï¼ˆ2017 å¹´ 6 æœˆï¼‰, 3 å¹´æ—¶é—´çš„å®‰å…¨ä¿®å¤ï¼ˆ2018 å¹´ 6 æœˆï¼‰ã€‚
			</p>
			 <p>
			 	LTS ç‰ˆæœ¬æ˜¯æ­¤é¡¹ç›®èƒ½æä¾›çš„æœ€é•¿æ—¶é—´ç»´æŠ¤ç‰ˆæœ¬ã€‚ä¸€èˆ¬çš„å‘è¡Œç‰ˆæœ¬, åªæä¾› 6 ä¸ªæœˆçš„ Bug ä¿®å¤æ”¯æŒ, ä¸€å¹´çš„å®‰å…¨ä¿®å¤æ”¯æŒ.
			 </p>
		</div>

		<div class="main-content">
			<h1>é˜Ÿåˆ—</h1>
<ul>
<li><a href="#introduction">ç®€ä»‹</a></li>
<li><a href="#writing-job-classes">ç¼–å†™ä»»åŠ¡ç±»</a>
<ul>
<li><a href="#generating-job-classes">ç”Ÿæˆä»»åŠ¡ç±»</a></li>
<li><a href="#job-class-structure">ä»»åŠ¡ç±»ç»“æ„</a></li>
</ul></li>
<li><a href="#pushing-jobs-onto-the-queue">å°†ä»»åŠ¡æ¨é€åˆ°é˜Ÿåˆ—ä¸Š</a>
<ul>
<li><a href="#delayed-jobs">å»¶è¿Ÿæ€§ä»»åŠ¡</a></li>
<li><a href="#dispatching-jobs-from-requests">ä»è¯·æ±‚ä¸­æ´¾é€ä»»åŠ¡</a></li>
<li><a href="#job-events">ä»»åŠ¡äº‹ä»¶</a></li>
</ul></li>
<li><a href="#running-the-queue-listener">è¿è¡Œé˜Ÿåˆ—ä¾¦å¬å™¨</a>
<ul>
<li><a href="#supervisor-configuration">Supervisor è®¾ç½®</a></li>
<li><a href="#daemon-queue-listener">å°†ä»»åŠ¡ä¾¦å¬å™¨è®¾ä¸ºåå°æœåŠ¡</a></li>
<li><a href="#deploying-with-daemon-queue-listeners">éšç€åœ¨åå°æœåŠ¡çš„ä»»åŠ¡ä¾¦å¬å™¨è¿›è¡Œå¸ƒç½²</a></li>
</ul></li>
<li><a href="#dealing-with-failed-jobs">å¤„ç†å¤±è´¥çš„ä»»åŠ¡</a>
<ul>
<li><a href="#failed-job-events">ä»»åŠ¡å¤±è´¥äº‹ä»¶</a></li>
<li><a href="#retrying-failed-jobs">é‡æ–°å°è¯•è¿è¡Œå¤±è´¥ä»»åŠ¡</a></li>
</ul></li>
</ul>
<p><a name="introduction"></a></p>
<h2>ç®€ä»‹</h2>
<p>Laravel çš„é˜Ÿåˆ—æœåŠ¡ä¸ºä¸åŒçš„é˜Ÿåˆ—åç«¯ç³»ç»Ÿæä¾›äº†ä¸€å¥—ç»Ÿä¸€çš„ API ã€‚é˜Ÿåˆ—å…è®¸ä½ å°†ä¸€ä¸ªè€—æ—¶çš„ä»»åŠ¡è¿›è¡Œå»¶è¿Ÿå¤„ç†ï¼Œä¾‹å¦‚åƒ e-mail å‘é€ã€‚è¿™èƒ½è®©åº”ç”¨ç¨‹åºå¯¹é¡µé¢çš„è¯·æ±‚æœ‰æ›´å¿«çš„å“åº”ã€‚</p>
<p><a name="configuration"></a></p>
<h3>é…ç½®</h3>
<p>é˜Ÿåˆ—çš„é…ç½®æ–‡ä»¶è¢«ä¿å­˜åœ¨ <code>config/queue.php</code> ä¸­ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶å†…ä½ å¯ä»¥æ‰¾åˆ°åŒ…å«åœ¨ Laravel ä¸­çš„æ¯ä¸€ç§é˜Ÿåˆ—é©±åŠ¨è¿æ¥è®¾ç½®ã€‚å®ƒä»¬åŒ…å«äº†æ•°æ®åº“ã€<a href="javascript:if(confirm('http://kr.github.com/beanstalkd  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://kr.github.com/beanstalkd'" tppabs="http://kr.github.com/beanstalkd">Beanstalkd</a>ã€<a href="javascript:if(confirm('http://iron.io/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://iron.io/'" tppabs="http://iron.io/">IronMQ</a>ã€<a href="javascript:if(confirm('http://aws.amazon.com/sqs  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://aws.amazon.com/sqs'" tppabs="http://aws.amazon.com/sqs">Amazon SQS</a>ã€<a href="javascript:if(confirm('http://redis.io/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://redis.io/'" tppabs="http://redis.io/">Redis</a> ä»¥åŠæä¾›æœ¬æœºä½¿ç”¨çš„ synchronous é©±åŠ¨ã€‚</p>
<p>å¦å¤–æ¡†æ¶ä¹Ÿæä¾›äº† <code>null</code> è¿™ä¸ªé˜Ÿåˆ—é©±åŠ¨ç”¨æ¥ä¸¢å¼ƒé˜Ÿåˆ—ä»»åŠ¡ã€‚</p>
<h3>é©±åŠ¨çš„å¿…è¦è®¾ç½®</h3>
<h4>æ•°æ®åº“</h4>
<p>è¦ä½¿ç”¨ <code>database</code> è¿™ä¸ªé˜Ÿåˆ—é©±åŠ¨çš„è¯ï¼Œåˆ™éœ€è¦åˆ›å»ºä¸€ä¸ªæ•°æ®è¡¨æ¥è®°ä½ä»»åŠ¡ï¼Œä½ å¯ä»¥ç”¨ <code>queue:table</code> è¿™ä¸ª Artisan å‘½ä»¤æ¥åˆ›å»ºè¿™ä¸ªæ•°æ®è¡¨çš„è¿ç§»ã€‚å½“è¿ç§»å»ºå¥½åï¼Œå°±å¯ä»¥ç”¨ <code>migrate</code> è¿™ä¸ªå‘½ä»¤æ¥åˆ›å»ºæ•°æ®è¡¨ã€‚</p>
<pre><code>php artisan queue:table

php artisan migrate</code></pre>
<h4>å…¶å®ƒé˜Ÿåˆ—ç³»ç»Ÿçš„ä¾èµ–æ‰©å±•åŒ…</h4>
<p>åœ¨ä½¿ç”¨åˆ—è¡¨é‡Œçš„é˜Ÿåˆ—æœåŠ¡å‰ï¼Œå¿…é¡»å®‰è£…ä»¥ä¸‹ä¾èµ–æ‰©å±•åŒ…ï¼š</p>
<ul>
<li>Amazon SQSï¼š<code>aws/aws-sdk-php ~3.0</code></li>
<li>Beanstalkdï¼š<code>pda/pheanstalk ~3.0</code></li>
<li>IronMQï¼š<code>iron-io/iron_mq ~2.0|~4.0</code></li>
<li>Redisï¼š<code>predis/predis ~1.0</code></li>
</ul>
<p><a name="writing-job-classes"></a></p>
<h2>ç¼–å†™ä»»åŠ¡ç±»</h2>
<p><a name="generating-job-classes"></a></p>
<h3>ç”Ÿæˆä»»åŠ¡ç±»</h3>
<p>åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­ï¼Œé˜Ÿåˆ—çš„ä»»åŠ¡ç±»éƒ½é»˜è®¤æ”¾åœ¨ <code>app/Jobs</code> ç›®å½•ä¸‹ï¼Œä½ å¯ä»¥ç”¨ä»¥ä¸‹çš„ Artisan å‘½ä»¤æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„é˜Ÿåˆ—ä»»åŠ¡ï¼š</p>
<pre><code>php artisan make:job SendReminderEmail --queued</code></pre>
<p>è¿™ä¸ªå‘½ä»¤å°†ä¼šåœ¨ <code>app/Jobs</code> ä¸‹ç”Ÿæˆä¸€ä¸ªæ–°çš„ç±»ï¼Œè€Œè¿™ä¸ªç±»ä¼šå®ç° <code>Illuminate\Contracts\Queue\ShouldQueue</code> æ¥å£ï¼Œè®© Laravel çŸ¥é“è¿™ä¸ªä»»åŠ¡åº”è¯¥æ˜¯è¢«æ”¾åˆ°é˜Ÿåˆ—é‡Œçš„ï¼Œè€Œä¸æ˜¯è¦ç›´æ¥è¿è¡Œã€‚</p>
<p><a name="job-class-structure"></a></p>
<h3>ä»»åŠ¡ç±»ç»“æ„</h3>
<p>ä»»åŠ¡ç±»çš„ç»“æ„å¾ˆç®€å•ï¼Œä¸€èˆ¬æ¥è¯´åªä¼šåŒ…å«ä¸€ä¸ªè®©é˜Ÿåˆ—ç”¨æ¥è°ƒç”¨æ­¤ä»»åŠ¡çš„ <code>handle</code> æ–¹æ³•ã€‚æˆ‘ä»¬ç”¨ä»¥ä¸‹è¿™ä¸ªç±»æ¥åšç¤ºèŒƒï¼š</p>
<pre><code>&lt;?php

namespace App\Jobs;

use App\User;
use App\Jobs\Job;
use Illuminate\Contracts\Mail\Mailer;
use Illuminate\Queue\SerializesModels;
use Illuminate\Queue\InteractsWithQueue;
use Illuminate\Contracts\Bus\SelfHandling;
use Illuminate\Contracts\Queue\ShouldQueue;

class SendReminderEmail extends Job implements SelfHandling, ShouldQueue
{
    use InteractsWithQueue, SerializesModels;

    protected $user;

    /**
     * åˆ›å»ºä¸€ä¸ªæ–°çš„ä»»åŠ¡å®ä¾‹ã€‚
     *
     * @param  User  $user
     * @return void
     */
    public function __construct(User $user)
    {
        $this-&gt;user = $user;
    }

    /**
     * è¿è¡Œä»»åŠ¡ã€‚
     *
     * @param  Mailer  $mailer
     * @return void
     */
    public function handle(Mailer $mailer)
    {
        $mailer-&gt;send('emails.reminder', ['user' =&gt; $this-&gt;user], function ($m) {
            //
        });

        $this-&gt;user-&gt;reminders()-&gt;create(...);
    }
}</code></pre>
<p>æ³¨æ„ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨ä»»åŠ¡ç±»çš„æ„é€ å™¨ä¸­ç›´æ¥ä¼ é€’äº†ä¸€ä¸ª <a href="eloquent.htm" tppabs="http://laravel-china.org/docs/5.1/eloquent">Eloquent æ¨¡å‹</a>ã€‚å› ä¸ºæˆ‘ä»¬åœ¨ä»»åŠ¡ç±»é‡Œå¼•ç”¨äº† <code>SerializesModels</code> è¿™ä¸ª traitï¼Œä½¿å¾— Eloquent æ¨¡å‹åœ¨å¤„ç†ä»»åŠ¡æ—¶å¯ä»¥è¢«ä¼˜é›…åœ°åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚å¦‚æœä½ çš„é˜Ÿåˆ—ä»»åŠ¡ç±»åœ¨æ„é€ å™¨ä¸­æ¥æ”¶äº†ä¸€ä¸ª Eloquent æ¨¡å‹ï¼Œé‚£ä¹ˆåªæœ‰å¯è¯†åˆ«å‡ºè¯¥æ¨¡å‹çš„å±æ€§ä¼šè¢«åºåˆ—åŒ–åˆ°é˜Ÿåˆ—é‡Œã€‚å½“ä»»åŠ¡è¢«å®é™…è¿è¡Œæ—¶ï¼Œé˜Ÿåˆ—ç³»ç»Ÿä¾¿ä¼šè‡ªåŠ¨ä»æ•°æ®åº“ä¸­é‡æ–°å–å›å®Œæ•´çš„æ¨¡å‹ã€‚è¿™æ•´ä¸ªè¿‡ç¨‹å¯¹ä½ çš„åº”ç”¨ç¨‹åºæ¥è¯´æ˜¯å®Œå…¨é€æ˜çš„ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨åºåˆ—åŒ–å®Œæ•´çš„ Eloquent æ¨¡å¼å®ä¾‹æ—¶æ‰€å¸¦æ¥çš„ä¸€äº›é—®é¢˜ã€‚</p>
<p>åœ¨é˜Ÿåˆ—å¤„ç†ä»»åŠ¡æ—¶ï¼Œä¼šè°ƒç”¨ <code>handle</code> æ–¹æ³•ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <code>handle</code> æ–¹æ³•çš„å‚æ•°ç±»å‹æç¤ºï¼Œè®© Laravel çš„<a href="container.htm" tppabs="http://laravel-china.org/docs/5.1/container">æœåŠ¡å®¹å™¨</a>è‡ªåŠ¨æ³¨å…¥ä¾èµ–å¯¹è±¡ã€‚</p>
<h4>å½“å‘ç”Ÿé”™è¯¯çš„æ—¶å€™</h4>
<p>å¦‚æœåœ¨å¤„ç†ä»»åŠ¡æ—¶æŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œå®ƒå°†ä¼šè‡ªåŠ¨è¢«é‡Šæ”¾å›é˜Ÿåˆ—é‡Œå¹¶å†æ¬¡å°è¯•è¿è¡Œã€‚å½“è¯¥ä»»åŠ¡ä¸€ç›´å‡ºé”™æ—¶ï¼Œå®ƒä¼šä¸æ–­è¢«å‘å¸ƒé‡è¯•ï¼Œç›´åˆ°è¶…è¿‡åº”ç”¨ç¨‹åºæ‰€å…è®¸çš„æœ€å¤§é‡è¯•å€¼ã€‚æœ€å¤§é‡è¯•å€¼å¯ä»¥åœ¨è¿è¡Œ <code>queue:listen</code> æˆ– <code>queue:work</code> å‘½ä»¤æ—¶ï¼Œç”¨ <code>--tries</code> é€‰é¡¹æ¥è®¾ç½®ã€‚å…³äºè¿è¡Œé˜Ÿåˆ—ä¾¦å¬å™¨çš„æ›´å¤šä¿¡æ¯åœ¨ç¨åä¼šæœ‰<a href="#running-the-queue-listener">è¯¦ç»†è¯´æ˜</a>ã€‚</p>
<h4>æ‰‹åŠ¨é‡Šæ”¾ä»»åŠ¡</h4>
<p>ç”Ÿæˆå‡ºæ¥çš„ä»»åŠ¡ç±»å¼•ç”¨äº† <code>InteractsWithQueue</code> è¿™ä¸ª traitï¼Œå®ƒæä¾›äº† <code>release</code> æ–¹æ³•è®©æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨é‡Šæ”¾ä»»åŠ¡ã€‚åœ¨ <code>release</code> æ–¹æ³•ä¸­å¯æŒ‡å®šä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºæ­¤ä»»åŠ¡è¢«é‡æ–°è¿è¡Œä¹‹å‰æ‰€ç­‰å¾…çš„ç§’æ•°ã€‚</p>
<pre><code>public function handle(Mailer $mailer)
{
    if (condition) {
        $this-&gt;release(10);
    }
}</code></pre>
<h4>æ£€æŸ¥é‡è¯•æ¬¡æ•°</h4>
<p>å¦‚å‰é¢æ‰€æåˆ°çš„ï¼Œå½“ä»»åŠ¡è¢«å¤„ç†æ—¶è‹¥å‘ç”Ÿä¸€äº›å¼‚å¸¸ï¼Œåˆ™ä»»åŠ¡å°†ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾å›é˜Ÿåˆ—ä¸­ã€‚è¿™æ—¶å€™å¯ä»¥ç”¨ <code>attempt</code> æ–¹æ³•æ¥æ£€æŸ¥é‡è¯•æ¬¡æ•°ï¼š</p>
<pre><code>public function handle(Mailer $mailer)
{
    if ($this-&gt;attempts() &gt; 3) {
        //
    }
}</code></pre>
<p><a name="pushing-jobs-onto-the-queue"></a></p>
<h2>å°†ä»»åŠ¡æ¨é€åˆ°é˜Ÿåˆ—ä¸Š</h2>
<p>åœ¨ <code>app/Http/Controllers/Controller.php</code> ä¸­ Laravel å®šä¹‰äº†ä¸€ä¸ªé»˜è®¤æ§åˆ¶å™¨ï¼Œå®ƒå¼•ç”¨äº† <code>DispatchesJob</code> è¿™ä¸ª traitã€‚è€Œè¿™ä¸ª trait æä¾›äº†æ•°ä¸ªæ–¹æ³•æ¥æ–¹ä¾¿ä½ æ¨é€ä»»åŠ¡åˆ°é˜Ÿåˆ—ä¸Šï¼Œä¾‹å¦‚ <code>dispatch</code> æ–¹æ³•ï¼š</p>
<pre><code>&lt;?php

namespace App\Http\Controllers;

use App\User;
use Illuminate\Http\Request;
use App\Jobs\SendReminderEmail;
use App\Http\Controllers\Controller;

class UserController extends Controller
{
    /**
     * å‘é€æé†’çš„ e-mail ç»™æŒ‡å®šç”¨æˆ·ã€‚
     *
     * @param  Request  $request
     * @param  int  $id
     * @return Response
     */
    public function sendReminderEmail(Request $request, $id)
    {
        $user = User::findOrFail($id);

        $this-&gt;dispatch(new SendReminderEmail($user));
    }
}</code></pre>
<p>å½“ç„¶æœ‰æ—¶å€™ä½ ä¸ä¸€å®šæ˜¯ä»åº”ç”¨ç¨‹åºçš„è·¯ç”±æˆ–æ§åˆ¶å™¨æ¥æ´¾å‘ä»»åŠ¡çš„ï¼Œå› æ­¤ä½ å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•ç±»é‡Œå¼•ç”¨ <code>DispatchesJobs</code> è¿™ä¸ª trait ï¼Œä»¥ä¾¿ä½¿ç”¨å®ƒçš„å„ç§æ´¾å‘æ–¹æ³•ã€‚ä»¥ä¸‹å°±æ˜¯ä½¿ç”¨è¯¥ trait çš„ç±»ï¼š</p>
<pre><code>&lt;?php

namespace App;

use Illuminate\Foundation\Bus\DispatchesJobs;

class ExampleClass
{
    use DispatchesJobs;
}</code></pre>
<h4>æŒ‡å®šä»»åŠ¡æ‰€å±çš„é˜Ÿåˆ—</h4>
<p>ä½ å¯ä»¥æŒ‡å®šä»»åŠ¡åº”è¯¥è¦é€åˆ°å“ªä¸€ä¸ªé˜Ÿåˆ—ä¸Šã€‚</p>
<p>è¦æ¨é€ä»»åŠ¡åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸Šï¼Œä½ éœ€è¦å°†ä»»åŠ¡å…ˆã€Œåˆ†ç±»ã€ï¼Œç”šè‡³å¯èƒ½è¦æŒ‡å®šæ¯ä¸ªé˜Ÿåˆ—èƒ½æœ‰å¤šå°‘ä½œä¸šå™¨å¯ä»¥è¿è¡Œä»»åŠ¡ã€‚è¿™å¹¶ä¸ä¼šæ¨é€ä»»åŠ¡åˆ°ä½ åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰€å®šä¹‰çš„ä¸åŒé˜Ÿåˆ—ã€Œè¿æ¥ã€ä¸Šï¼Œè€Œæ˜¯ä¼šæ¨é€åˆ°æŸä¸ªæœ‰å•ä¸ªè¿æ¥çš„é˜Ÿåˆ—ã€‚è¦æŒ‡å®šä»»åŠ¡è¿è¡Œçš„é˜Ÿåˆ—ï¼Œå¯ä»¥ç”¨ä»»åŠ¡å®ä¾‹çš„ <code>onQueue</code> æ–¹æ³•ã€‚<code>onQueue</code> æ˜¯ <code>Illuminate\Bus\Queueable</code> trait æ‰€æä¾›çš„æ–¹æ³•ï¼Œè€Œå®ƒå·²ç»åŒ…å«åœ¨ <code>App\Jobs\Job</code> åŸºç±»ä¸­ï¼š</p>
<pre><code>&lt;?php

namespace App\Http\Controllers;

use App\User;
use Illuminate\Http\Request;
use App\Jobs\SendReminderEmail;
use App\Http\Controllers\Controller;

class UserController extends Controller
{
    /**
     * å‘é€æé†’çš„ e-mail ç»™æŒ‡å®šç”¨æˆ·ã€‚
     *
     * @param  Request  $request
     * @param  int  $id
     * @return Response
     */
    public function sendReminderEmail(Request $request, $id)
    {
        $user = User::findOrFail($id);

        $job = (new SendReminderEmail($user))-&gt;onQueue('emails');

        $this-&gt;dispatch($job);
    }
}</code></pre>
<p><a name="delayed-jobs"></a></p>
<h3>å»¶è¿Ÿæ€§ä»»åŠ¡</h3>
<p>æœ‰æ—¶ä½ å¯èƒ½ä¼šå¸Œæœ›é˜Ÿåˆ—ä»»åŠ¡èƒ½æ™šä¸€ç‚¹å†è¿è¡Œï¼Œä¾‹å¦‚åœ¨ç”¨æˆ·æ³¨å†Œ 15 åˆ†é’Ÿåæ‰é€šè¿‡é˜Ÿåˆ—ä»»åŠ¡å‘é€æé†’ä¿¡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡ä»»åŠ¡ç±»å¼•ç”¨çš„ <code>Illuminate\Bus\Queueable</code> è¿™ä¸ª trait æ‰€æä¾›çš„ <code>delay</code> æ–¹æ³•æ¥å®ç°ï¼š</p>
<pre><code>&lt;?php

namespace App\Http\Controllers;

use App\User;
use Illuminate\Http\Request;
use App\Jobs\SendReminderEmail;
use App\Http\Controllers\Controller;

class UserController extends Controller
{
    /**
     * å‘é€æé†’çš„ e-mail ç»™æŒ‡å®šç”¨æˆ·ã€‚
     *
     * @param  Request  $request
     * @param  int  $id
     * @return Response
     */
    public function sendReminderEmail(Request $request, $id)
    {
        $user = User::findOrFail($id);

        $job = (new SendReminderEmail($user))-&gt;delay(60);

        $this-&gt;dispatch($job);
    }
}</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬æŒ‡å®šè¯¥ä»»åŠ¡å»¶è¿Ÿ 60 ç§’åå†è¿è¡Œã€‚</p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong>Amazon çš„ SQS æœåŠ¡æœ€å¤§çš„å»¶è¿Ÿæ—¶é—´æ˜¯ 15 åˆ†é’Ÿã€‚</p>
</blockquote>
<p><a name="dispatching-jobs-from-requests"></a></p>
<h3>ä»è¯·æ±‚ä¸­æ´¾é€ä»»åŠ¡</h3>
<p>Laravel æä¾›äº†ä¸€äº›è¾…åŠ©å‡½æ•°ä»¥æ–¹ä¾¿ä½ åœ¨ä»»åŠ¡ä¸­å¯¹åº” HTTP è¯·æ±‚çš„å˜é‡ã€‚åƒæ˜¯åœ¨ <code>DispatchesJobs</code> è¿™ä¸ª trait å°±æä¾›äº† <code>dispatchFrom</code> æ–¹æ³•ï¼Œè€Œ Laravel åŸºç¡€æ§åˆ¶å™¨å·²ç»é»˜è®¤å¼•å…¥äº†è¿™ä¸ª traitï¼š</p>
<pre><code>&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Http\Controllers\Controller;

class CommerceController extends Controller
{
    /**
     * å¤„ç†æŒ‡å®šçš„è®¢å•ã€‚
     *
     * @param  Request  $request
     * @param  int  $id
     * @return Response
     */
    public function processOrder(Request $request, $id)
    {
        // å¤„ç†è¯¥è¯·æ±‚...

        $this-&gt;dispatchFrom('App\Jobs\ProcessOrder', $request);
    }
}</code></pre>
<p>è¿™ä¸ªæ–¹æ³•ä¼šæ£€æŸ¥ä»»åŠ¡ç±»çš„æ„é€ å™¨ï¼Œå¹¶ä¸”ä» HTTP è¯·æ±‚ (æˆ–ä»»ä½• <code>ArrayAccess</code> å¯¹è±¡) ä¸­å–å‡ºå˜é‡ï¼Œæ¥ä½œä¸ºæ„é€ å™¨ä¸­éœ€è¦çš„å‚æ•°ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬çš„ä»»åŠ¡ç±»æ„é€ å™¨æ¥å—ä¸€ä¸ª <code>productId</code> å˜é‡çš„è¯ï¼Œé‚£ä¹ˆé˜Ÿåˆ—å°±ä¼šè¯•ç€ä» HTTP è¯·æ±‚ä¸­æå– <code>productId</code> è¿™ä¸ªå‚æ•°ã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥å°†ä¸€ä¸ªæ•°ç»„ä¼ å…¥åˆ° <code>dispatchFrom</code> æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°é‡Œï¼Œè¿™ä¸ªæ•°ç»„ä¼šè¢«ç”¨æ¥ä½œä¸ºæ„é€ å™¨ä¸­æ‰€æœ‰ä¸åœ¨è¯·æ±‚é‡Œçš„å˜é‡ï¼š</p>
<pre><code>$this-&gt;dispatchFrom('App\Jobs\ProcessOrder', $request, [
    'taxPercentage' =&gt; 20,
]);</code></pre>
<p><a name="job-events"></a></p>
<h3>ä»»åŠ¡äº‹ä»¶</h3>
<h4>ä»»åŠ¡å®Œæˆäº‹ä»¶</h4>
<p><code>Queue::after</code> æ–¹æ³•å¯ä»¥è®©ä½ æ³¨å†Œä¸€ä¸ªé˜Ÿåˆ—ä»»åŠ¡è¿è¡Œå®Œæˆåä¼šè¢«æ‰§è¡Œçš„å›è°ƒã€‚åœ¨æ­¤å›è°ƒè¿›è¡Œé¢å¤–çºªå½•ã€é˜Ÿåˆ—åç»­ä»»åŠ¡ã€æˆ–ä¸ºä»ªè¡¨æ¿å¢åŠ ç»Ÿè®¡ç­‰æ“ä½œéƒ½æ˜¯å¾ˆå¥½çš„æ—¶æœºã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Laravel æ‰€åŒ…å«çš„ <code>AppServiceProvider</code> ä¸­é™„åŠ ä¸€ä¸ªå›è°ƒåˆ°æ­¤äº‹ä»¶ä¸Šï¼š</p>
<pre><code>&lt;?php

namespace App\Providers;

use Queue;
use Illuminate\Support\ServiceProvider;

class AppServiceProvider extends ServiceProvider
{
    /**
     * å¯åŠ¨æ‰€æœ‰åº”ç”¨ç¨‹åºæœåŠ¡ã€‚
     *
     * @return void
     */
    public function boot()
    {
        Queue::after(function ($connection, $job, $data) {
            //
        });
    }

    /**
     * æ³¨å†ŒæœåŠ¡æä¾›è€…ã€‚
     *
     * @return void
     */
    public function register()
    {
        //
    }
}</code></pre>
<p><a name="running-the-queue-listener"></a></p>
<h2>è¿è¡Œé˜Ÿåˆ—ä¾¦å¬å™¨</h2>
<h4>å¯åŠ¨é˜Ÿåˆ—ä¾¦å¬å™¨</h4>
<p>Laravel å¼•å…¥äº†ä¸€ä¸ª Artisan å‘½ä»¤ï¼Œç”¨æ¥è¿è¡Œè¢«æ¨é€åˆ°é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ã€‚ä½ å¯ä»¥é€šè¿‡ <code>queue:listen</code> å‘½ä»¤æ¥è¿è¡Œä¾¦å¬å™¨ï¼š</p>
<pre><code>php artisan queue:listen</code></pre>
<p>ä½ ä¹Ÿå¯ä»¥æŒ‡å®šä¾¦å¬å™¨åº”è¯¥åˆ©ç”¨å“ªä¸€ä¸ªé˜Ÿåˆ—è¿›è¡Œè¿æ¥ï¼š</p>
<pre><code>php artisan queue:listen connection</code></pre>
<p>è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™ä¸ªå·¥ä½œå‘½ä»¤å¯åŠ¨åï¼Œå®ƒå°†ä¼šç»§ç»­è¿è¡Œç›´åˆ°è¢«æ‰‹åŠ¨åœæ­¢ä¸ºæ­¢ã€‚ä½ å¯ä»¥åˆ©ç”¨åƒ <a href="javascript:if(confirm('http://supervisord.org/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://supervisord.org/'" tppabs="http://supervisord.org/">Supervisor</a> è¿™æ ·çš„è¿›ç¨‹ç›‘æ§è½¯ä»¶ï¼Œæ¥ç¡®ä¿é˜Ÿåˆ—ä¾¦å¬å™¨ä¸ä¼šåœæ­¢è¿è¡Œã€‚</p>
<h4>é˜Ÿåˆ—ä¼˜å…ˆé¡ºåº</h4>
<p>ä½ å¯ä»¥ç»™ <code>listen</code> å‘½ä»¤ä¸€ä¸ªä»¥é€—å·åˆ†éš”çš„é˜Ÿåˆ—è¿æ¥åˆ—è¡¨ï¼Œæ¥è®¾ç½®é˜Ÿåˆ—çš„ä¼˜å…ˆé¡ºåºï¼š</p>
<pre><code>php artisan queue:listen --queue=high,low</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œåœ¨ <code>high</code> è¿™ä¸ªé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ°¸è¿œä¼šå…ˆè¢«å¤„ç†ï¼Œç„¶åæ‰æ˜¯ <code>low</code> é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ã€‚</p>
<h4>æŒ‡å®šä»»åŠ¡çš„è¶…æ—¶å‚æ•°</h4>
<p>ä½ è¿˜å¯ä»¥è®¾ç½®æ¯ä¸ªä»»åŠ¡è¢«å…è®¸è¿è¡Œçš„æ—¶é—´é•¿åº¦ï¼Œå•ä½æ˜¯ç§’æ•°ï¼š</p>
<pre><code>php artisan queue:listen --timeout=60</code></pre>
<h4>æŒ‡å®šé˜Ÿåˆ—çš„ä¼‘çœ æœŸ</h4>
<p>æ­¤å¤–ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‡å®šé˜Ÿåˆ—è¦ç­‰å¾…å¤šå°‘ç§’åæ‰èƒ½å–æ–°çš„ä»»åŠ¡æ¥è¿è¡Œï¼š</p>
<pre><code>php artisan queue:listen --sleep=5</code></pre>
<p>æ³¨æ„è¿™é‡Œæ˜¯æŒ‡é˜Ÿåˆ—åœ¨æ²¡æœ‰ä»»åŠ¡çš„çŠ¶æ€ä¸‹æ‰ä¼šä¼‘çœ ã€‚å¦‚æœå·²ç»æœ‰å¤šä¸ªä»»åŠ¡å¡åœ¨è¿™ä¸ªé˜Ÿåˆ—ä¸Šï¼Œé‚£ä¹ˆå®ƒä¼šæŒç»­è¿è¡Œè€Œä¸ä¼šä¼‘çœ ã€‚</p>
<p><a name="supervisor-configuration"></a></p>
<h3>Supervisor è®¾ç½®</h3>
<p>Supervisor æ˜¯ä¸€ä¸ª Linux æ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹ç›‘æ§è½¯ä»¶ï¼Œå®ƒä¼šåœ¨ <code>queue:listen</code> æˆ– <code>queue:work</code> å‘½ä»¤å‘ç”Ÿå¤±è´¥åè‡ªåŠ¨é‡å¯å®ƒä»¬ã€‚è¦åœ¨ Ubuntu å®‰è£… Supervisorï¼Œå¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code>sudo apt-get install supervisor</code></pre>
<p>Supervisor çš„é…ç½®æ–‡ä»¶ä¸€èˆ¬æ˜¯æ”¾åœ¨ <code>/etc/supervisor/conf.d</code> ç›®å½•ä¸‹ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸­ä½ å¯ä»¥åˆ›å»ºä»»æ„æ•°é‡çš„é…ç½®æ–‡ä»¶æ¥è¦æ±‚ Supervisor ç›‘æ§ä½ çš„è¿›ç¨‹ã€‚ä¾‹å¦‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>laravel-worker.conf</code> æ¥å¯åŠ¨ä¸ç›‘æ§ä¸€ä¸ª <code>queue:work</code> è¿›ç¨‹ï¼š</p>
<pre><code>[program:laravel-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /home/forge/app.com/artisan queue:work sqs --sleep=3 --tries=3 --daemon
autostart=true
autorestart=true
user=forge
numprocs=8
redirect_stderr=true
stdout_logfile=/home/forge/app.com/worker.log</code></pre>
<p>è¿™ä¸ªä¾‹å­é‡Œçš„ <code>numprocs</code> å‘½ä»¤ä¼šè¦æ±‚ Supervisor è¿è¡Œå¹¶ç›‘æ§ 8 ä¸ª <code>queue:work</code> è¿›ç¨‹ï¼Œå¹¶ä¸”åœ¨å®ƒä»¬è¿è¡Œå¤±è´¥åé‡æ–°å¯åŠ¨ã€‚å½“ç„¶ï¼Œä½ å¿…é¡»æ›´æ”¹ <code>command</code> å‘½ä»¤çš„ <code>queue:work sqs</code>ï¼Œä»¥æ˜¾ç¤ºä½ æ‰€é€‰æ‹©çš„é˜Ÿåˆ—é©±åŠ¨ã€‚</p>
<p>å½“è¿™ä¸ªé…ç½®æ–‡ä»¶è¢«åˆ›å»ºåï¼Œä½ éœ€è¦æ›´æ–° Supervisor çš„è®¾ç½®ï¼Œå¹¶ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨è¯¥è¿›ç¨‹ï¼š</p>
<pre><code>sudo supervisorctl reread

sudo supervisorctl update

sudo supervisorctl start laravel-worker:*</code></pre>
<p>æ›´å¤šæœ‰å…³ Supervisor çš„è®¾ç½®ä¸ä½¿ç”¨ï¼Œè¯·å‚è€ƒ <a href="javascript:if(confirm('http://supervisord.org/index.html  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://supervisord.org/index.html'" tppabs="http://supervisord.org/index.html">Supervisor å®˜æ–¹æ–‡æ¡£</a>ã€‚æˆ–æ˜¯ä½¿ç”¨ <a href="javascript:if(confirm('https://forge.laravel.com/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ÊÇÒ»¸öÊ¹ÓÃÎ´Ö§³ÖĞ­ÒéµÄµØÖ·(ÀıÈç: gopher)¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='https://forge.laravel.com/'" tppabs="https://forge.laravel.com/">Laravel Forge</a> æ‰€æä¾›çš„ Web æ¥å£ï¼Œæ¥è‡ªåŠ¨è®¾ç½®ä¸ç®¡ç†ä½ çš„ Supervisor è®¾ç½®ã€‚</p>
<p><a name="daemon-queue-listener"></a></p>
<h3>å°†ä»»åŠ¡ä¾¦å¬å™¨è®¾ä¸ºåå°æœåŠ¡</h3>
<p>åœ¨ <code>queue:work</code> Artisan å‘½ä»¤é‡ŒåŒ…å«äº† <code>--daemon</code> é€‰é¡¹ï¼Œå¼ºåˆ¶é˜Ÿåˆ—æœåŠ¡å™¨æŒç»­å¤„ç†ä»»åŠ¡ï¼Œè€Œä¸éœ€è¦é‡æ–°å¯åŠ¨æ•´ä¸ªæ¡†æ¶ã€‚æ¯”èµ· <code>queue:listen</code> å‘½ä»¤ï¼Œè¿™å°†æ˜æ˜¾çš„å‡å°‘ CPU çš„ç”¨é‡ã€‚</p>
<p>ç”¨ <code>--daemon</code> æ——æ ‡åœ¨åå°æœåŠ¡æ¨¡å¼ä¸‹å¯åŠ¨é˜Ÿåˆ—æœåŠ¡å™¨ï¼š</p>
<pre><code>php artisan queue:work connection --daemon

php artisan queue:work connection --daemon --sleep=3

php artisan queue:work connection --daemon --sleep=3 --tries=3</code></pre>
<p>å¦‚ä½ æ‰€è§ï¼Œ<code>queue:work</code> å‘½ä»¤æä¾›äº†å¤šä¸ªå’Œ <code>queue:listen</code> å‘½ä»¤ç›¸åŒçš„é€‰é¡¹ã€‚ä½ å¯ä»¥ç”¨ <code>php artisan help queue:work</code> å‘½ä»¤æ¥æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„é€‰é¡¹ã€‚</p>
<h3>åœ¨åå°æœåŠ¡çš„é˜Ÿåˆ—ä¾¦å¬å™¨ä¸­å¼€å‘æ—¶æ‰€è¦è€ƒé‡çš„äº‹é¡¹</h3>
<p>åœ¨åå°è¿è¡Œçš„é˜Ÿåˆ—ä¾¦å¬å™¨åœ¨å¤„ç†å®Œæ¯ä¸ªä»»åŠ¡å‰ä¸ä¼šé‡æ–°å¯åŠ¨æ¡†æ¶ã€‚å› æ­¤ä½ åº”è¯¥åœ¨ä»»åŠ¡è¿è¡Œå®Œæˆå‰ï¼Œè°¨æ…åœ°é‡Šæ”¾æ‰€æœ‰å†…å­˜å ç”¨è¾ƒé«˜çš„èµ„æºã€‚ä¾‹å¦‚ä½ åˆ©ç”¨ GD å‡½æ•°åº“æ¥å¤„ç†å›¾ç‰‡ï¼Œå°±è¦åœ¨ç»“æŸå‰ç”¨ <code>imagedestroy</code> æ¥é‡Šæ”¾å†…å­˜ã€‚</p>
<p>å¦‚æœä½ çš„æ•°æ®åº“è¿æ¥ä¹Ÿè¦åœ¨ä½¿ç”¨å®Œåè¿›è¡Œå…³é—­ï¼Œåˆ™å¯ä»¥ç”¨ <code>DB::reconnect</code> æ–¹æ³•æ¥ç¡®ä¿æœ‰æ–°çš„æ•°æ®åº“è¿›è¡Œè¿æ¥ã€‚</p>
<p><a name="deploying-with-daemon-queue-listeners"></a></p>
<h3>åœ¨åå°ä»»åŠ¡ä¾¦å¬å™¨è¿›è¡Œå¸ƒç½²</h3>
<p>ç”±äºåå°é˜Ÿåˆ—å·¥ä½œå™¨æ˜¯é•¿é©»è¿›ç¨‹ï¼Œå› æ­¤é™¤éé˜Ÿåˆ—é‡æ–°å¯åŠ¨ï¼Œå¦åˆ™ä»»ä½•ä»£ç ä¸Šçš„ä»»ä½•ä¿®æ”¹éƒ½ä¸ä¼šè¢«åº”ç”¨ã€‚æ‰€ä»¥è¦å¸ƒç½²ä¸€ä¸ªæœ‰ç”¨åˆ°åå°é˜Ÿåˆ—æœåŠ¡å™¨çš„åº”ç”¨ç¨‹åºï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯åœ¨å¸ƒç½²è„šæœ¬æ–‡ä»¶ä¸­å¯¹ä½œä¸šå™¨è¿›è¡Œé‡å¯ã€‚ä½ å¯ä»¥åœ¨å¸ƒç½²å‘½ä»¤ä¸­åŠ å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œæ¥ä¼˜é›…åœ°é‡å¯æ‰€æœ‰ä½œä¸šå™¨ï¼š</p>
<pre><code>php artisan queue:restart</code></pre>
<p>è¿™ä¸ªå‘½ä»¤ä¼šä¼˜é›…åœ°å‘ŠçŸ¥æ‰€æœ‰é˜Ÿåˆ—æœåŠ¡å™¨ï¼Œåœ¨å®ƒä»¬å¤„ç†å®Œå½“å‰ä»»åŠ¡åé‡æ–°å¯åŠ¨ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰ä»»åŠ¡é—å¤±çš„é—®é¢˜ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong>è¿™ä¸ªå‘½ä»¤ä¾é ç¼“å­˜ç³»ç»Ÿæ¥å®‰æ’ä»»åŠ¡çš„é‡æ–°å¯åŠ¨ã€‚é»˜è®¤çŠ¶å†µä¸‹ï¼ŒAPCu æ— æ³•åœ¨ CLI çš„ä»»åŠ¡ä¸Šè¿ä½œã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ APCu çš„è¯ï¼Œè¯·æŠŠ <code>apc.enable_cli=1</code> åŠ åˆ°ä½ çš„ APCu è®¾ç½®é‡Œã€‚</p>
</blockquote>
<p><a name="dealing-with-failed-jobs"></a></p>
<h2>å¤„ç†å¤±è´¥çš„ä»»åŠ¡</h2>
<p>è®¡åˆ’æ°¸è¿œèµ¶ä¸ä¸Šå˜åŒ–ï¼Œæœ‰æ—¶å€™ä½ çš„é˜Ÿåˆ—ä»»åŠ¡å°±æ˜¯ä¼šå¤±è´¥ã€‚ä¸è¿‡åˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬æœ‰å‡†å¤‡å¥½å®ƒå‘ç”Ÿæ—¶çš„åº”å¯¹æ–¹æ³•ã€‚Laravel æœ‰ä¸ªå¾ˆæ–¹ä¾¿çš„æ–¹å¼å¯ä»¥æŒ‡å®šä»»åŠ¡çš„æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚å½“ä»»åŠ¡è¿è¡Œè¶…è¿‡è¯¥é‡è¯•æ¬¡æ•°æ—¶ï¼Œå®ƒå°±ä¼šè¢«å†™å…¥è‡³ <code>failed_jobs</code> è¿™ä¸ªæ•°æ®è¡¨ä¸­ã€‚è€Œå¤±è´¥ä»»åŠ¡çš„åç§°å¯ä»¥åœ¨ <code>config/queue.php</code> è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­è®¾ç½®ã€‚</p>
<p>è¦åˆ›å»º <code>failed_jobs</code> æ•°æ®è¡¨çš„è¿ç§»ç±»ï¼Œä½ å¯ä»¥ç”¨ <code>queue:failed-table</code> å‘½ä»¤ï¼š</p>
<pre><code>php artisan queue:failed-table</code></pre>
<p>å½“ä½ è¿è¡Œ<a href="#running-the-queue-listener">é˜Ÿåˆ—ä¾¦å¬å™¨</a>æ—¶ï¼Œå¯ä»¥ç”¨ <code>queue:listen</code> å‘½ä»¤çš„ <code>--tries</code> å‚æ•°æ¥æŒ‡å®šä»»åŠ¡çš„æœ€å¤§é‡è¯•æ¬¡æ•°ï¼š</p>
<pre><code>php artisan queue:listen connection-name --tries=3</code></pre>
<p><a name="failed-job-events"></a></p>
<h3>ä»»åŠ¡å¤±è´¥äº‹ä»¶</h3>
<p>å¦‚æœä½ æƒ³æ³¨å†Œä¸€ä¸ªå½“é˜Ÿåˆ—ä»»åŠ¡å¤±è´¥æ—¶ä¼šè¢«è°ƒç”¨çš„äº‹ä»¶ï¼Œåˆ™å¯ä»¥ç”¨ <code>Queue::failing</code> æ–¹æ³•ã€‚è¿™æ ·ä½ å°±æœ‰æœºä¼šé€šè¿‡è¿™ä¸ªäº‹ä»¶æ¥ç”¨ e-mail æˆ– <a href="javascript:if(confirm('https://www.hipchat.com/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ÊÇÒ»¸öÊ¹ÓÃÎ´Ö§³ÖĞ­ÒéµÄµØÖ·(ÀıÈç: gopher)¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='https://www.hipchat.com/'" tppabs="https://www.hipchat.com/">HipChat</a> é€šçŸ¥ä½ çš„å›¢é˜Ÿã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥åœ¨ Laravel å†…ç½®çš„ <code>AppServiceProvider</code> ä¸­å¯¹è¿™ä¸ªäº‹ä»¶é™„åŠ ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼š</p>
<pre><code>&lt;?php

namespace App\Providers;

use Queue;
use Illuminate\Support\ServiceProvider;

class AppServiceProvider extends ServiceProvider
{
    /**
     * å¯åŠ¨ä»»ä½•åº”ç”¨ç¨‹åºçš„æœåŠ¡ã€‚
     *
     * @return void
     */
    public function boot()
    {
        Queue::failing(function ($connection, $job, $data) {
            // é€šçŸ¥å›¢é˜Ÿå¤±è´¥çš„ä»»åŠ¡...
        });
    }

    /**
     * æ³¨å†ŒæœåŠ¡å®¹å™¨ã€‚
     *
     * @return void
     */
    public function register()
    {
        //
    }
}</code></pre>
<h4>åœ¨ä»»åŠ¡ç±»é‡Œå¤„ç†å¤±è´¥çš„æ–¹æ³•</h4>
<p>å¦‚æœæƒ³æœ‰æ‹¥æœ‰æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œåˆ™å¯ä»¥åœ¨åœ¨ä»»åŠ¡ç±»é‡Œç›´æ¥å®šä¹‰ä¸€ä¸ª <code>failed</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å…è®¸ä½ æŒ‡å®šé”™è¯¯å‘ç”Ÿæ—¶è¯¥æ‰§è¡Œå“ªäº›åŠ¨ä½œã€‚</p>
<pre><code>&lt;?php

namespace App\Jobs;

use App\Jobs\Job;
use Illuminate\Contracts\Mail\Mailer;
use Illuminate\Queue\SerializesModels;
use Illuminate\Queue\InteractsWithQueue;
use Illuminate\Contracts\Bus\SelfHandling;
use Illuminate\Contracts\Queue\ShouldQueue;

class SendReminderEmail extends Job implements SelfHandling, ShouldQueue
{
    use InteractsWithQueue, SerializesModels;

    /**
     * è¿è¡Œä»»åŠ¡ã€‚
     *
     * @param  Mailer  $mailer
     * @return void
     */
    public function handle(Mailer $mailer)
    {
        //
    }

    /**
     * å¤„ç†ä¸€ä¸ªå¤±è´¥çš„ä»»åŠ¡
     *
     * @return void
     */
    public function failed()
    {
        // å½“ä»»åŠ¡å¤±è´¥æ—¶ä¼šè¢«è°ƒç”¨...
    }
}</code></pre>
<p><a name="retrying-failed-jobs"></a></p>
<h3>é‡æ–°å°è¯•è¿è¡Œå¤±è´¥ä»»åŠ¡</h3>
<p>è¦æŸ¥çœ‹ä½ åœ¨ <code>failed_jobs</code> æ•°æ®è¡¨ä¸­çš„æ‰€æœ‰å¤±è´¥ä»»åŠ¡ï¼Œåˆ™å¯ä»¥ç”¨ <code>queue:failed</code> è¿™ä¸ª Artisan å‘½ä»¤ï¼š</p>
<pre><code>php artisan queue:failed</code></pre>
<p><code>queue:failed</code> å‘½ä»¤ä¼šåˆ—å‡ºæ‰€æœ‰ä»»åŠ¡çš„ IDã€è¿æ¥ã€é˜Ÿåˆ—ä»¥åŠå¤±è´¥æ—¶é—´ï¼Œä»»åŠ¡ ID å¯ä»¥è¢«ç”¨åœ¨é‡è¯•å¤±è´¥çš„ä»»åŠ¡ä¸Šã€‚ä¾‹å¦‚è¦é‡è¯•ä¸€ä¸ª ID ä¸º 5 çš„å¤±è´¥ä»»åŠ¡ï¼Œå…¶å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code>php artisan queue:retry 5</code></pre>
<p>è¦é‡è¯•æ‰€æœ‰å¤±è´¥çš„ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ <code>queue:retry</code> å¹¶ä½¿ç”¨ <code>all</code> ä½œä¸º IDï¼š</p>
<pre><code>php artisan queue:retry all</code></pre>
<p>å¦‚æœä½ æƒ³åˆ é™¤æ‰ä¸€ä¸ªå¤±è´¥ä»»åŠ¡ï¼Œå¯ä»¥ç”¨ <code>queue:forget</code> å‘½ä»¤ï¼š</p>
<pre><code>php artisan queue:forget 5</code></pre>
<p><code>queue:flush</code> å‘½ä»¤å¯ä»¥è®©ä½ åˆ é™¤æ‰€æœ‰å¤±è´¥çš„ä»»åŠ¡ï¼š</p>
<pre><code>php artisan queue:flush</code></pre>
		</div>

		<div class="main-footer" style="border-top:1px dashed rgba(0, 0, 0, 0.1);padding-top: 30px;margin-top:30px;margin-bottom: 20px;">
			<div class="prev-next-wrap clearfix">

									<a class="btn btn-default pull-left" href="pagination.htm" tppabs="http://laravel-china.org/docs/5.1/pagination"><i class="fa fa-arrow-left"></i> åˆ†é¡µ</a>
				
			    &nbsp;
								    <a class="btn btn-default pull-right" href="redis.htm" tppabs="http://laravel-china.org/docs/5.1/redis">Redis <i class="fa fa-arrow-right"></i></a>
							</div>
		</div>

	</article>
</div>

		<footer class="main">
			<ul>
				<li class="nav-docs"><a href="javascript:if(confirm('http://laravel-china.org/docs  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://laravel-china.org/docs'" tppabs="http://laravel-china.org/docs">æ–‡æ¡£</a></li>
<li class="nav-laracasts"><a href="javascript:if(confirm('https://laracasts.com/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ÊÇÒ»¸öÊ¹ÓÃÎ´Ö§³ÖĞ­ÒéµÄµØÖ·(ÀıÈç: gopher)¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='https://laracasts.com/'" tppabs="https://laracasts.com/" target="_blank">Laracasts</a></li>
<li class="nav-docs"><a href="javascript:if(confirm('http://lumen.laravel-china.org/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://lumen.laravel-china.org/'" tppabs="http://lumen.laravel-china.org/">Lumen</a></li>
<li class="nav-forge"><a href="javascript:if(confirm('https://cs.phphub.org/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ÊÇÒ»¸öÊ¹ÓÃÎ´Ö§³ÖĞ­ÒéµÄµØÖ·(ÀıÈç: gopher)¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='https://cs.phphub.org/'" tppabs="https://cs.phphub.org/" target="_blank">Laravel LTS é€ŸæŸ¥è¡¨</a></li>
<li class="dropdown">
	<a href="javascript:if(confirm('https://phphub.org/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ÊÇÒ»¸öÊ¹ÓÃÎ´Ö§³ÖĞ­ÒéµÄµØÖ·(ÀıÈç: gopher)¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='https://phphub.org/'" tppabs="https://phphub.org/" target="_blank">Laravel ç¤¾åŒº</a>
</li>
			</ul>
			<p>Laravel is a trademark of Taylor Otwell. Copyright &copy; Taylor Otwell.</p>
			<p class="less-significant"><a href="javascript:if(confirm('http://jackmcdade.com/  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://jackmcdade.com/'" tppabs="http://jackmcdade.com/">Design by Jack McDade</a></p>

			<p class="less-significant">
				<a href="javascript:if(confirm('http://www.ucloud.cn/?utm_source=zanzhu&utm_campaign=phphub&utm_medium=display&utm_content=yejiao&ytag=phphubyejiao  \n\n¸ÃÎÄ¼şÎ´±» Teleport Pro ÏÂÔØ£¬ÒòÎª ËüÎ»ÓÚÆğÊ¼µØÖ·ÒÔÉèÖÃµÄ±ß½çÒÔÍâµÄÓò»òÂ·¾¶ÖĞ¡£  \n\nÄãÏëÒª´Ó·şÎñÆ÷´ò¿ªËüÂğ?'))window.location='http://www.ucloud.cn/?utm_source=zanzhu&utm_campaign=phphub&utm_medium=display&utm_content=yejiao&ytag=phphubyejiao'" tppabs="http://www.ucloud.cn/?utm_source=zanzhu&utm_campaign=phphub&utm_medium=display&utm_content=yejiao&ytag=phphubyejiao" target="_blank">ç”± UCloud èµåŠ©  <img src="dYfOYswiQY.png" tppabs="https://dn-phphub.qbox.me/uploads/images/201605/03/1/dYfOYswiQY.png" width="98" data-toggle="tooltip" data-placement="top" title="æœ¬ç«™æœåŠ¡å™¨ç”± UCloud èµåŠ©"></a>.
		      </p>
		</footer>

	</div>

	<script src="laravel.js" tppabs="http://laravel-china.org/assets/js/laravel.js"></script>
	<script src="viewport-units-buggyfill.js" tppabs="http://laravel-china.org/assets/js/viewport-units-buggyfill.js"></script>
	<script>window.viewportUnitsBuggyfill.init();</script>
    <script>

		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','analytics.js'/*tpa=http://7xijlf.com2.z0.glb.qiniucdn.com/js/analytics.js*/,'ga');

		ga('create', 'UA-53903425-7', 'auto');
		ga('send', 'pageview');

		$(window).load(function() {
		  // When the page has loaded
		  $(".main-content").fadeIn(10);
		});
    </script>
</body>
</html>
